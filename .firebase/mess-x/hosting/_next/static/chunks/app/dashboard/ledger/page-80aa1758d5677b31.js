(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9603],{12137:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>w});var l=t(95155),a=t(12115),n=t(66695),r=t(85127),i=t(59409),d=t(66424),c=t(50172),o=t(75943),u=t(77223),m=t(87481),h=t(93004),x=t(56104),f=t(35695),p=t(98905),j=t(83013),N=t(83343),v=t(90010),g=t(30285),b=t(63894);let y=e=>{let{personal:s,guest:t}=e,a=null!=t?t:0,n=e=>e.toFixed(1).replace(/\.0$/,"");return(0,l.jsxs)(l.Fragment,{children:[n(null!=s?s:0),a>0&&(0,l.jsxs)("span",{className:"text-muted-foreground",children:[" (",n(a),")"]})]})};function w(){var e;let[s,t]=(0,a.useState)(null),[w,k]=(0,a.useState)(null),[S,A]=(0,a.useState)([]),[C,L]=(0,a.useState)(""),[O,I]=(0,a.useState)([]),[E,R]=(0,a.useState)(!0),[B,F]=(0,a.useState)(!1),[M,D]=(0,a.useState)(!1),[P,Z]=(0,a.useState)(!1),[z,_]=(0,a.useState)(null),[G,H]=(0,a.useState)(!1),T=(0,f.useRouter)(),{toast:U}=(0,m.dj)();(0,a.useEffect)(()=>{let e=(0,h.hg)(x.j2,e=>{e?(R(!0),(0,p.VM)(e.uid).then(e=>{t(e),(null==e?void 0:e.messId)?((0,p.ZJ)(e.messId).then(e=>{var s;return k(null!=(s=null==e?void 0:e.mealSettings)?s:null)}),(0,p.pR)(e.messId).then(A).catch(e=>{console.error("Failed to load members",e),U({title:"Error",description:"Could not load members.",variant:"destructive"})})):(U({title:"No Mess Found",description:"You need to be in a mess to view this page.",variant:"destructive"}),T.push("/welcome"))}).finally(()=>R(!1))):T.push("/login")});return()=>e()},[T,U]);let V=(0,a.useCallback)(()=>{C&&(null==s?void 0:s.messId)&&(F(!0),I([]),(0,p.nE)(s.messId,C,30).then(I).catch(e=>{console.error("Failed to fetch meal ledger",e),U({title:"Error",description:"Could not load the meal ledger for the selected member.",variant:"destructive"})}).finally(()=>F(!1)))},[C,null==s?void 0:s.messId,U]);(0,a.useEffect)(()=>{V()},[V]);let $=e=>{_(e),D(!0)},q=e=>{_(e),Z(!0)},J=async()=>{if(z&&(null==s?void 0:s.messId)&&C){H(!0);try{await (0,p.AS)(s.messId,C,z.date,{breakfast:0,lunch:0,dinner:0,guestBreakfast:0,guestLunch:0,guestDinner:0,isSetByUser:!0}),U({title:"Success",description:"Meal record has been cleared."}),V()}catch(e){console.error("Failed to delete record:",e),U({title:"Error",description:"Could not clear the record.",variant:"destructive"})}finally{H(!1),Z(!1),_(null)}}},W=(null==(e=S.find(e=>e.id===C))?void 0:e.name)||"",Y=(null==s?void 0:s.role)==="manager",K=+(null!=w&&!!w.isBreakfastOn)+ +(null!=w&&!!w.isLunchOn)+ +(null!=w&&!!w.isDinnerOn);return E?(0,l.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,l.jsx)(c.A,{className:"h-8 w-8 animate-spin"})}):(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(n.Zp,{children:[(0,l.jsxs)(n.aR,{children:[(0,l.jsx)(n.ZB,{className:"font-headline",children:"Meal Ledger"}),(0,l.jsx)(n.BT,{children:"Select a member to view their meal history for the last 30 days."})]}),(0,l.jsx)(n.Wu,{children:(0,l.jsxs)("div",{className:"grid gap-2 max-w-sm",children:[(0,l.jsx)("label",{htmlFor:"member-select",className:"text-sm font-medium",children:"Select Member"}),(0,l.jsxs)(i.l6,{value:C,onValueChange:L,children:[(0,l.jsx)(i.bq,{id:"member-select",children:(0,l.jsx)(i.yv,{placeholder:"Select a member..."})}),(0,l.jsx)(i.gC,{children:S.map(e=>(0,l.jsx)(i.eb,{value:e.id,children:e.name},e.id))})]})]})})]}),C&&(0,l.jsxs)(n.Zp,{children:[(0,l.jsx)(n.aR,{children:(0,l.jsxs)(n.ZB,{className:"font-headline",children:["Showing Ledger for ",W]})}),(0,l.jsx)(n.Wu,{children:B?(0,l.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,l.jsx)(c.A,{className:"h-8 w-8 animate-spin"})}):(0,l.jsx)(d.F,{className:"h-[60vh]",children:(0,l.jsxs)(r.XI,{children:[(0,l.jsx)(r.A0,{className:"sticky top-0 bg-card",children:(0,l.jsxs)(r.Hj,{children:[(0,l.jsx)(r.nd,{children:"Date"}),(null==w?void 0:w.isBreakfastOn)&&(0,l.jsx)(r.nd,{className:"text-center",children:"Breakfast (Guest)"}),(null==w?void 0:w.isLunchOn)&&(0,l.jsx)(r.nd,{className:"text-center",children:"Lunch (Guest)"}),(null==w?void 0:w.isDinnerOn)&&(0,l.jsx)(r.nd,{className:"text-center",children:"Dinner (Guest)"}),(0,l.jsx)(r.nd,{className:"text-center",children:"Total"}),Y&&(0,l.jsx)(r.nd,{className:"text-right",children:"Actions"})]})}),(0,l.jsx)(r.BF,{children:O.length>0?O.map(e=>{let s=(e.breakfast||0)+(e.lunch||0)+(e.dinner||0)+(e.guestBreakfast||0)+(e.guestLunch||0)+(e.guestDinner||0);return(0,l.jsxs)(r.Hj,{children:[(0,l.jsx)(r.nA,{className:"font-medium",children:(0,j.GP)((0,N.H)(e.date),"EEEE, MMM d")}),(null==w?void 0:w.isBreakfastOn)&&(0,l.jsx)(r.nA,{className:"text-center font-mono",children:(0,l.jsx)(y,{personal:e.breakfast,guest:e.guestBreakfast})}),(null==w?void 0:w.isLunchOn)&&(0,l.jsx)(r.nA,{className:"text-center font-mono",children:(0,l.jsx)(y,{personal:e.lunch,guest:e.guestLunch})}),(null==w?void 0:w.isDinnerOn)&&(0,l.jsx)(r.nA,{className:"text-center font-mono",children:(0,l.jsx)(y,{personal:e.dinner,guest:e.guestDinner})}),(0,l.jsx)(r.nA,{className:"text-center font-bold font-mono",children:s.toFixed(1).replace(/\.0$/,"")}),Y&&(0,l.jsxs)(r.nA,{className:"text-right",children:[(0,l.jsx)(g.$,{variant:"ghost",size:"icon",onClick:()=>$(e),disabled:G,children:(0,l.jsx)(o.A,{className:"h-4 w-4"})}),(0,l.jsx)(g.$,{variant:"ghost",size:"icon",onClick:()=>q(e),className:"text-destructive hover:text-destructive",disabled:G,children:G&&(null==z?void 0:z.date)===e.date?(0,l.jsx)(c.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(u.A,{className:"h-4 w-4"})})]})]},e.date)}):(0,l.jsx)(r.Hj,{children:(0,l.jsx)(r.nA,{colSpan:2+K+ +!!Y,className:"text-center text-muted-foreground h-24",children:"No meal records found for this member in the last 30 days."})})})]})})})]}),Y&&(null==s?void 0:s.messId)&&C&&W&&z&&(0,l.jsx)(b.c,{isOpen:M,setIsOpen:e=>{D(e),e||_(null)},messId:s.messId,memberId:C,memberName:W,initialDate:z.date,mealSettings:w,onSuccess:V}),(0,l.jsx)(v.Lt,{open:P,onOpenChange:Z,children:(0,l.jsxs)(v.EO,{children:[(0,l.jsxs)(v.wd,{children:[(0,l.jsx)(v.r7,{children:"Are you sure?"}),(0,l.jsxs)(v.$v,{children:["This will clear the entire meal record (personal and guest) for ",(0,l.jsx)("strong",{children:W})," on ",(null==z?void 0:z.date)?(0,j.GP)((0,N.H)(z.date),"PPP"):"",". This action cannot be undone."]})]}),(0,l.jsxs)(v.ck,{children:[(0,l.jsx)(v.Zr,{onClick:()=>_(null),children:"Cancel"}),(0,l.jsxs)(v.Rx,{onClick:J,disabled:G,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[G&&(0,l.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirm Delete"]})]})]})})]})}},33375:(e,s,t)=>{Promise.resolve().then(t.bind(t,12137))},59409:(e,s,t)=>{"use strict";t.d(s,{bq:()=>m,eb:()=>p,gC:()=>f,l6:()=>o,yv:()=>u});var l=t(95155),a=t(12115),n=t(31992),r=t(79556),i=t(77381),d=t(10518),c=t(59434);let o=n.bL;n.YJ;let u=n.WT,m=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,l.jsxs)(n.l9,{ref:s,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[a,(0,l.jsx)(n.In,{asChild:!0,children:(0,l.jsx)(r.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=n.l9.displayName;let h=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(n.PP,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,l.jsx)(i.A,{className:"h-4 w-4"})})});h.displayName=n.PP.displayName;let x=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(n.wn,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,l.jsx)(r.A,{className:"h-4 w-4"})})});x.displayName=n.wn.displayName;let f=a.forwardRef((e,s)=>{let{className:t,children:a,position:r="popper",...i}=e;return(0,l.jsx)(n.ZL,{children:(0,l.jsxs)(n.UC,{ref:s,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r,...i,children:[(0,l.jsx)(h,{}),(0,l.jsx)(n.LM,{className:(0,c.cn)("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,l.jsx)(x,{})]})})});f.displayName=n.UC.displayName,a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(n.JU,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...a})}).displayName=n.JU.displayName;let p=a.forwardRef((e,s)=>{let{className:t,children:a,...r}=e;return(0,l.jsxs)(n.q7,{ref:s,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[(0,l.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,l.jsx)(n.VF,{children:(0,l.jsx)(d.A,{className:"h-4 w-4"})})}),(0,l.jsx)(n.p4,{children:a})]})});p.displayName=n.q7.displayName,a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(n.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...a})}).displayName=n.wv.displayName},66424:(e,s,t)=>{"use strict";t.d(s,{F:()=>i});var l=t(95155),a=t(12115),n=t(47655),r=t(59434);let i=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,l.jsxs)(n.bL,{ref:s,className:(0,r.cn)("relative overflow-hidden",t),...i,children:[(0,l.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,l.jsx)(d,{}),(0,l.jsx)(n.OK,{})]})});i.displayName=n.bL.displayName;let d=a.forwardRef((e,s)=>{let{className:t,orientation:a="vertical",...i}=e;return(0,l.jsx)(n.VM,{ref:s,orientation:a,className:(0,r.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...i,children:(0,l.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=n.VM.displayName}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,3644,1982,8502,7239,9032,7328,5876,5152,3013,7655,5576,4257,1785,8200,5951,4987,8441,1684,7358],()=>s(33375)),_N_E=e.O()}]);