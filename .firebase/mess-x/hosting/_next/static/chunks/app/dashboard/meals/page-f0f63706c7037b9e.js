(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8162],{22346:(e,t,s)=>{"use strict";s.d(t,{w:()=>i});var r=s(95155),a=s(12115),n=s(87489),l=s(59434);let i=a.forwardRef((e,t)=>{let{className:s,orientation:a="horizontal",decorative:i=!0,...d}=e;return(0,r.jsx)(n.b,{ref:t,decorative:i,orientation:a,className:(0,l.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",s),...d})});i.displayName=n.b.displayName},26126:(e,t,s)=>{"use strict";s.d(t,{E:()=>i});var r=s(95155);s(12115);var a=s(74466),n=s(59434);let l=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)(l({variant:s}),t),...a})}},32680:(e,t,s)=>{Promise.resolve().then(s.bind(s,62096))},55365:(e,t,s)=>{"use strict";s.d(t,{Fc:()=>d,TN:()=>o,XL:()=>c});var r=s(95155),a=s(12115),n=s(74466),l=s(59434);let i=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=a.forwardRef((e,t)=>{let{className:s,variant:a,...n}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(i({variant:a}),s),...n})});d.displayName="Alert";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h5",{ref:t,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",s),...a})});c.displayName="AlertTitle";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",s),...a})});o.displayName="AlertDescription"},62096:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var r=s(95155),a=s(12115),n=s(66695),l=s(85057),i=s(62523),d=s(22346),c=s(55365),o=s(85127),u=s(23478),m=s(79556),f=s(59434);let h=u.bL,x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(u.q7,{ref:t,className:(0,f.cn)("border-b",s),...a})});x.displayName="AccordionItem";let v=a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsx)(u.Y9,{className:"flex",children:(0,r.jsxs)(u.l9,{ref:t,className:(0,f.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...n,children:[a,(0,r.jsx)(m.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});v.displayName=u.l9.displayName;let j=a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsx)(u.UC,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,r.jsx)("div",{className:(0,f.cn)("pb-4 pt-0",s),children:a})})});j.displayName=u.UC.displayName;var b=s(90010),g=s(30285),p=s(24371),y=s(50172),N=s(59119),k=s(8376),w=s(75943),C=s(77223),S=s(50594),L=s(93004),A=s(56104),I=s(35695),E=s(98905),O=s(87481),B=s(83013),T=s(83343),D=s(63894),F=s(26126);let M=e=>{let{personal:t,guest:s,isSet:a}=e,n=null!=s?s:0;if(!a&&0===n)return(0,r.jsx)(p.A,{className:"mx-auto h-4 w-4 text-muted-foreground"});let l=e=>e.toFixed(1).replace(/\.0$/,""),i=a?l(null!=t?t:0):"-";return(0,r.jsxs)(r.Fragment,{children:[i,n>0&&(0,r.jsxs)("span",{className:"text-muted-foreground",children:[" (",l(n),")"]})]})};function R(){let[e,t]=(0,a.useState)(null),[s,u]=(0,a.useState)(null),[m,f]=(0,a.useState)(null),[p,R]=(0,a.useState)(null),[U,H]=(0,a.useState)([]),[_,G]=(0,a.useState)({}),[P,Z]=(0,a.useState)(!0),[z,$]=(0,a.useState)(!0),[V,Y]=(0,a.useState)({}),[X,J]=(0,a.useState)(!0),[W,q]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(!1),[ee,et]=(0,a.useState)(null),es=(0,I.useRouter)(),{toast:er}=(0,O.dj)(),ea=(0,a.useCallback)(()=>{if(e&&(null==s?void 0:s.messId)){Z(!0);let t=s.messId;(0,E.OG)(t,e.uid).then(e=>{f(e),J(e.isSetByUser||!1)}).catch(e=>{console.error("Failed to fetch today's meal status",e),er({title:"Error",description:"Could not load today's meal status.",variant:"destructive"})}).finally(()=>{Z(!1)})}},[e,s,er]),en=(0,a.useCallback)(()=>{(null==s?void 0:s.messId)&&($(!0),(0,E.tj)(s.messId,7).then(e=>{H(e)}).catch(e=>{console.error("Failed to fetch meal history",e),er({title:"Error",description:"Could not load meal history.",variant:"destructive"})}).finally(()=>{$(!1)}))},[s,er]);(0,a.useEffect)(()=>{let e=(0,L.hg)(A.j2,e=>{e?(t(e),(0,E.VM)(e.uid).then(u)):es.push("/login")});return()=>e()},[es]),(0,a.useEffect)(()=>{e&&(null==s?void 0:s.messId)&&(ea(),en(),(0,E.ZJ)(s.messId).then(e=>{R({breakfastCutoff:"02:00",lunchCutoff:"13:00",dinnerCutoff:"20:00",isBreakfastOn:!0,isLunchOn:!0,isDinnerOn:!0,isCutoffEnabled:!0,...(null==e?void 0:e.mealSettings)||{}})}))},[e,s,ea,en]),(0,a.useEffect)(()=>{let e=()=>{"visible"===document.visibilityState&&(ea(),en())};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[ea,en]),(0,a.useEffect)(()=>{G(U.reduce((e,t)=>{let s=t.date;return e[s]||(e[s]=[]),e[s].push(t),e},{}))},[U]);let el=(e,t)=>{let s=parseFloat(t);if(""===t){f(t=>t?{...t,[e]:0}:null),J(!1);return}!isNaN(s)&&s>=0&&(f(t=>t?{...t,[e]:s}:null),J(!1))},ei=async()=>{if(e&&(null==s?void 0:s.messId)&&m){Y({save:!0});try{await (0,E.AV)(s.messId,e.uid,m),er({title:"Success",description:"Your meal choices for today have been saved."}),J(!0),ea(),en()}catch(e){console.error("Failed to update meals:",e),er({title:"Update Failed",description:"Could not save your meal choices.",variant:"destructive"})}finally{Y({save:!1})}}},{isBreakfastLocked:ed,isLunchLocked:ec,isDinnerLocked:eo,breakfastCutoffTime:eu,lunchCutoffTime:em,dinnerCutoffTime:ef}=(0,a.useMemo)(()=>{if(!p)return{isBreakfastLocked:!0,isLunchLocked:!0,isDinnerLocked:!0,breakfastCutoffTime:"N/A",lunchCutoffTime:"N/A",dinnerCutoffTime:"N/A"};let e=e=>e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),[t,s]=p.breakfastCutoff.split(":").map(Number),r=new Date;r.setHours(t,s,0,0);let[a,n]=p.lunchCutoff.split(":").map(Number),l=new Date;l.setHours(a,n,0,0);let[i,d]=p.dinnerCutoff.split(":").map(Number),c=new Date;if(c.setHours(i,d,0,0),!1===p.isCutoffEnabled)return{isBreakfastLocked:!1,isLunchLocked:!1,isDinnerLocked:!1,breakfastCutoffTime:e(r),lunchCutoffTime:e(l),dinnerCutoffTime:e(c)};let o=new Date;return{isBreakfastLocked:o>r,isLunchLocked:o>l,isDinnerLocked:o>c,breakfastCutoffTime:e(r),lunchCutoffTime:e(l),dinnerCutoffTime:e(c)}},[p]),eh=e=>{var t;let{meal:s,isLocked:a}=e;return(0,r.jsx)(i.p,{id:"".concat(s,"-count"),type:"number",step:"0.5",min:"0",value:null!=(t=null==m?void 0:m[s])?t:"",onChange:e=>el(s,e.target.value),disabled:a||V.save,"aria-readonly":a,className:"w-20 text-center"})},ex=e=>{et(e),q(!0)},ev=e=>{et(e),Q(!0)},ej=async()=>{if(!ee||!(null==s?void 0:s.messId))return;let e="".concat(ee.memberId,"-").concat(ee.date);Y(t=>({...t,[e]:!0}));try{await (0,E.AS)(s.messId,ee.memberId,ee.date,{breakfast:0,lunch:0,dinner:0,guestBreakfast:0,guestLunch:0,guestDinner:0,isSetByUser:!0}),er({title:"Success",description:"Meal record has been cleared."}),en()}catch(e){console.error("Failed to delete record:",e),er({title:"Error",description:"Could not clear the record.",variant:"destructive"})}finally{Y(t=>({...t,[e]:!1})),Q(!1),et(null)}};if(P)return(0,r.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,r.jsx)(y.A,{className:"h-8 w-8 animate-spin"})});let eb=["breakfast","lunch","dinner"].filter(e=>{switch(e){case"breakfast":return null==p?void 0:p.isBreakfastOn;case"lunch":return null==p?void 0:p.isLunchOn;case"dinner":return null==p?void 0:p.isDinnerOn;default:return!1}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsxs)("div",{children:[(0,r.jsx)(n.ZB,{className:"font-headline",children:"Today's Meals"}),(0,r.jsx)(n.BT,{children:"Set your meal count for today. Toggles lock after the cut-off time."})]})}),(0,r.jsx)(n.Wu,{children:(0,r.jsx)("div",{className:"space-y-4",children:eb.length>0?eb.map((e,t)=>{let s="breakfast"===e?ed:"lunch"===e?ec:eo,n="breakfast"===e?eu:"lunch"===e?em:ef;return(0,r.jsxs)(a.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg ".concat(s?"bg-muted/50":""),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"".concat(e,"-count"),className:"text-base font-medium capitalize",children:e}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==p?void 0:p.isCutoffEnabled)?(0,r.jsxs)(r.Fragment,{children:["Cut-off: ",n,". ",s&&(0,r.jsx)("span",{className:"font-bold text-destructive",children:"Locked."})]}):"Cut-off times are disabled by manager."})]}),(0,r.jsx)(eh,{meal:e,isLocked:s})]}),t<eb.length-1&&(0,r.jsx)(d.w,{})]},e)}):(0,r.jsx)("p",{className:"text-center text-muted-foreground py-4",children:"All meals are currently disabled by the manager."})})}),(0,r.jsxs)(n.wL,{className:"border-t pt-6 flex items-center gap-4",children:[(0,r.jsxs)(g.$,{onClick:ei,disabled:X||V.save,children:[V.save?(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(N.A,{className:"mr-2 h-4 w-4"}),"Save Choices"]}),X&&(0,r.jsxs)(F.E,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:[(0,r.jsx)(k.A,{className:"mr-1 h-4 w-4"})," Saved"]})]})]}),(0,r.jsxs)(n.Zp,{children:[(0,r.jsxs)(n.aR,{children:[(0,r.jsx)(n.ZB,{className:"font-headline",children:"All Meal Records"}),(0,r.jsx)(n.BT,{children:"Meal records for all members for the last 7 days."})]}),(0,r.jsx)(n.Wu,{children:z?(0,r.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,r.jsx)(y.A,{className:"h-8 w-8 animate-spin"})}):(0,r.jsx)(h,{type:"single",collapsible:!0,className:"w-full",children:Object.keys(_).length>0?Object.entries(_).map(e=>{let[t,a]=e;return(0,r.jsxs)(x,{value:t,children:[(0,r.jsx)(v,{className:"font-headline text-lg",children:(0,B.GP)((0,T.H)(t),"EEEE, MMMM d, yyyy")}),(0,r.jsx)(j,{children:(0,r.jsxs)(o.XI,{children:[(0,r.jsx)(o.A0,{children:(0,r.jsxs)(o.Hj,{children:[(0,r.jsx)(o.nd,{children:"Member"}),(null==p?void 0:p.isBreakfastOn)&&(0,r.jsx)(o.nd,{className:"text-center",children:"Breakfast (Guest)"}),(null==p?void 0:p.isLunchOn)&&(0,r.jsx)(o.nd,{className:"text-center",children:"Lunch (Guest)"}),(null==p?void 0:p.isDinnerOn)&&(0,r.jsx)(o.nd,{className:"text-center",children:"Dinner (Guest)"}),(null==s?void 0:s.role)==="manager"&&(0,r.jsx)(o.nd,{className:"text-right",children:"Actions"})]})}),(0,r.jsx)(o.BF,{children:a.map(e=>(0,r.jsxs)(o.Hj,{children:[(0,r.jsx)(o.nA,{className:"font-medium",children:e.memberName}),(null==p?void 0:p.isBreakfastOn)&&(0,r.jsx)(o.nA,{className:"text-center font-mono",children:(0,r.jsx)(M,{personal:e.breakfast,guest:e.guestBreakfast,isSet:e.isSetByUser})}),(null==p?void 0:p.isLunchOn)&&(0,r.jsx)(o.nA,{className:"text-center font-mono",children:(0,r.jsx)(M,{personal:e.lunch,guest:e.guestLunch,isSet:e.isSetByUser})}),(null==p?void 0:p.isDinnerOn)&&(0,r.jsx)(o.nA,{className:"text-center font-mono",children:(0,r.jsx)(M,{personal:e.dinner,guest:e.guestDinner,isSet:e.isSetByUser})}),(null==s?void 0:s.role)==="manager"&&(0,r.jsxs)(o.nA,{className:"text-right",children:[(0,r.jsx)(g.$,{variant:"ghost",size:"icon",onClick:()=>ex(e),disabled:V["".concat(e.memberId,"-").concat(e.date)],children:(0,r.jsx)(w.A,{className:"h-4 w-4"})}),(0,r.jsx)(g.$,{variant:"ghost",size:"icon",onClick:()=>ev(e),className:"text-destructive hover:text-destructive",disabled:V["".concat(e.memberId,"-").concat(e.date)],children:V["".concat(e.memberId,"-").concat(e.date)]?(0,r.jsx)(y.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(C.A,{className:"h-4 w-4"})})]})]},e.memberId))})]})})]},t)}):(0,r.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No meal records found for the last 7 days."})})})]}),ee&&(null==s?void 0:s.messId)&&(0,r.jsx)(D.c,{isOpen:W,setIsOpen:e=>{q(e),e||et(null)},messId:s.messId,memberId:ee.memberId,memberName:ee.memberName,initialDate:ee.date,mealSettings:p,onSuccess:en}),(0,r.jsx)(b.Lt,{open:K,onOpenChange:Q,children:(0,r.jsxs)(b.EO,{children:[(0,r.jsxs)(b.wd,{children:[(0,r.jsx)(b.r7,{children:"Are you sure?"}),(0,r.jsxs)(b.$v,{children:["This will clear the meal record for ",(0,r.jsx)("strong",{children:null==ee?void 0:ee.memberName})," on ",(null==ee?void 0:ee.date)?(0,B.GP)((0,T.H)(ee.date),"PPP"):"",". This action cannot be undone."]})]}),(0,r.jsxs)(b.ck,{children:[(0,r.jsx)(b.Zr,{onClick:()=>et(null),children:"Cancel"}),(0,r.jsx)(b.Rx,{onClick:ej,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Confirm Delete"})]})]})}),(0,r.jsxs)(c.Fc,{children:[(0,r.jsx)(S.A,{className:"h-4 w-4"}),(0,r.jsx)(c.XL,{className:"font-headline",children:"Meal Ledger"}),(0,r.jsx)(c.TN,{children:(null==p?void 0:p.isCutoffEnabled)?"Your personal meal counts are timestamped in your Meal Ledger. If you miss a cut-off time, please contact your manager to override your meal status on the 'Members' page.":"Your personal meal counts are timestamped in your Meal Ledger. Cut-off times are currently disabled by the manager, so you can adjust your meals for today at any time."})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,1982,8502,7239,9032,7328,5876,5152,3013,5576,4257,1785,9091,5951,4987,8441,1684,7358],()=>t(32680)),_N_E=e.O()}]);